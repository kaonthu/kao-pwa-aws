<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒ©ï¸ AWS EC2 Ã— Gunicorn Ã— Nginx éƒ¨ç½²ç­†è¨˜ï½œKAO-YU-HSIANG</title>

  <!-- å…±ç”¨æ¨£å¼ -->
  <link href="/static/css/style.css" rel="stylesheet">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>
  <div id="header"></div>

  <main id="main" class="container">
    <div class="text-center mb-5">
      <h1>ğŸŒ©ï¸ AWS EC2 Ã— Gunicorn Ã— Nginx éƒ¨ç½²ç­†è¨˜</h1>
      <p class="text-muted">
        æœ¬é è¨˜éŒ„ EC2 ä¸Š Flask API çš„æ­£å¼éƒ¨ç½²æµç¨‹ï¼Œ  
        å¾è™›æ“¬ç’°å¢ƒå»ºç«‹ã€Gunicorn å•Ÿå‹•ã€Nginx åå‘ä»£ç†ï¼Œåˆ°å®‰å…¨ç¾¤çµ„èˆ‡æœ€çµ‚æœå‹™æ¸¬è©¦ã€‚
      </p>
    </div>

    <!-- ä¸€ã€å»ºç«‹æ–°è³‡æ–™å¤¾èˆ‡è™›æ“¬ç’°å¢ƒ -->
    <div class="section-title">ğŸ§© ä¸€ã€å»ºç«‹æ–°è³‡æ–™å¤¾èˆ‡è™›æ“¬ç’°å¢ƒ</div>
    <pre><code>cd ~
mkdir kao_flask_gunicorn && cd kao_flask_gunicorn
python3 -m venv venv && source venv/bin/activate
pip install flask flask-cors gunicorn
</code></pre>
    <p>æ­¤ç’°å¢ƒç¨ç«‹æ–¼åŸæœ¬ <code>kao_flask_api</code>ï¼Œä½œç‚ºæ­£å¼éƒ¨ç½²ç‰ˆæœ¬ã€‚</p>

    <!-- äºŒã€Flask æ‡‰ç”¨ï¼ˆapp_gunicorn.pyï¼‰ -->
    <div class="section-title">ğŸ§  äºŒã€Flask æ‡‰ç”¨ç¨‹å¼ï¼ˆapp_gunicorn.pyï¼‰</div>
    <pre><code>from flask import Flask, jsonify
from flask_cors import CORS
import datetime

app = Flask(__name__)
CORS(app)

@app.route("/")
def index():
    return jsonify({
        "message": "Hello from EC2 Flask (Gunicorn version)!",
        "server_time": datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    })

@app.route("/status")
def status():
    return jsonify({"status": "running", "version": "gunicorn-demo-v1.0"})

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5001)
</code></pre>
    <p>æ­¤ç‰ˆæœ¬ä½¿ç”¨ <code>port=5001</code>ï¼Œé¿å…èˆ‡åŸæœ¬ 5000 åŸ è¡çªã€‚</p>

    <!-- ä¸‰ã€ä½¿ç”¨ Gunicorn å•Ÿå‹• Flask -->
    <div class="section-title">âš™ï¸ ä¸‰ã€ä»¥ Gunicorn å•Ÿå‹• Flask æ‡‰ç”¨</div>
    <pre><code># å•Ÿå‹• Gunicornï¼ˆ2 å€‹ workerï¼Œç¶å®š 127.0.0.1:5001ï¼‰
gunicorn -w 2 -b 127.0.0.1:5001 app_gunicorn:app

# èƒŒæ™¯åŸ·è¡Œï¼ˆç™»å‡ºå¾Œä»æŒçºŒé‹è¡Œï¼‰
nohup gunicorn -w 2 -b 127.0.0.1:5001 app_gunicorn:app > gunicorn.log 2>&1 &

# æª¢æŸ¥èˆ‡æ¸¬è©¦
ps aux | grep gunicorn
curl http://127.0.0.1:5001/
</code></pre>

    <details>
      <summary>ğŸ”¹ è£œå……ï¼šGunicorn æŒ‡ä»¤åƒæ•¸èªªæ˜</summary>
      <ul>
        <li><b>-w 2ï¼š</b>ä»£è¡¨å»ºç«‹å…©å€‹ <code>worker process</code>ï¼Œèƒ½åŒæ™‚è™•ç†å¤šå€‹è«‹æ±‚ã€‚</li>
        <li><b>-b 127.0.0.1:5001ï¼š</b>åƒ…å…è¨±æœ¬æ©Ÿé€£ç·šï¼Œå¤–éƒ¨è«‹æ±‚å°‡é€é Nginx ä»£ç†ã€‚</li>
        <li><b>app_gunicorn:appï¼š</b>æŒ‡å®šæª”æ¡ˆåç¨±èˆ‡ Flask ç‰©ä»¶ï¼ˆæª”å:ç‰©ä»¶ï¼‰ã€‚</li>
      </ul>
      <p>é€™è¡ŒæŒ‡ä»¤çš„æ„ç¾©ï¼š</p>
      <blockquote>ã€Œè«‹ Gunicorn å»ºç«‹å…©å€‹ worker é€²ç¨‹ï¼Œç¶å®šåœ¨ 127.0.0.1:5001ï¼Œä¸¦è¼‰å…¥ <b>app_gunicorn.py</b> ä¸­çš„ <b>app</b> ç‰©ä»¶ã€‚ã€</blockquote>
    </details>

    <!-- å››ã€å®‰è£èˆ‡å•Ÿå‹• Nginx -->
    <div class="section-title">ğŸŒ å››ã€å®‰è£èˆ‡å•Ÿå‹• Nginxï¼ˆåå‘ä»£ç†ï¼‰</div>
    <pre><code>sudo dnf install nginx -y
sudo systemctl enable nginx
sudo systemctl start nginx
</code></pre>
    <p>Nginx è² è²¬æ¥æ”¶å¤–éƒ¨è«‹æ±‚ (Port 80)ï¼Œå†è½‰ç™¼çµ¦å…§éƒ¨çš„ Gunicorn (127.0.0.1:5001)ã€‚</p>

    <!-- äº”ã€Nginx ä»£ç†è¨­å®š -->
    <div class="section-title">ğŸ§± äº”ã€Nginx ä»£ç†è¨­å®šæª”</div>
    <pre><code>sudo nano /etc/nginx/conf.d/flask.conf
</code></pre>
    <pre><code>server {
    listen 80;
    server_name 18.176.60.86;

    location / {
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
</code></pre>
    <p>é€™æ¨£å¤–éƒ¨ <code>http://18.176.60.86</code> çš„è«‹æ±‚ï¼Œå°±æœƒè‡ªå‹•è½‰é€è‡³ Gunicornã€‚</p>

    <!-- å…­ã€å®‰å…¨ç¾¤çµ„è¨­å®š -->
    <div class="section-title">ğŸ”’ å…­ã€å®‰å…¨ç¾¤çµ„è¨­å®šï¼ˆAWS Consoleï¼‰</div>
    <p>æ–¼ <b>Security Groups â†’ launch-wizard-1 â†’ Inbound rules</b> æ–°å¢ä»¥ä¸‹è¦å‰‡ï¼š</p>
    <table class="table table-sm">
      <thead><tr><th>Type</th><th>Protocol</th><th>Port</th><th>Source</th><th>Description</th></tr></thead>
      <tbody>
        <tr><td>Custom TCP</td><td>TCP</td><td>5001</td><td>0.0.0.0/0</td><td>Flask-Gunicorn-Test</td></tr>
        <tr><td>HTTP</td><td>TCP</td><td>80</td><td>0.0.0.0/0</td><td>Nginx Web Access</td></tr>
      </tbody>
    </table>
    <p>é–‹æ”¾ 80 åŸ å¾Œï¼Œå¤–éƒ¨å³å¯ç›´æ¥è¨ªå• <code>http://18.176.60.86/</code> ç„¡éœ€æŒ‡å®š portã€‚</p>

    <!-- ä¸ƒã€æ•´é«”æµç¨‹èˆ‡æ¶æ§‹ç†è§£ -->
    <div class="section-title">ğŸ§© ä¸ƒã€æ•´é«”æµç¨‹ç†è§£èˆ‡æ¯”å–»</div>
    <p>
      å¯å°‡é€™å€‹æ¶æ§‹æƒ³åƒç‚ºï¼š
    </p>
    <ul>
      <li><b>Flask API</b> æ˜¯å·¥ç¨‹å¸«ï¼ˆè² è²¬é‚è¼¯èˆ‡è¨ˆç®—ï¼‰ã€‚</li>
      <li><b>Gunicorn</b> æ˜¯ä¸»ç®¡ï¼ˆè² è²¬åˆ†é…è«‹æ±‚çµ¦å¤šä½å·¥ç¨‹å¸«ï¼‰ã€‚</li>
      <li><b>Nginx</b> æ˜¯æ«ƒæª¯ï¼ˆè² è²¬æ¥å¾…å®¢æˆ¶ä¸¦åˆ†æ´¾çµ¦ä¸»ç®¡ï¼‰ã€‚</li>
    </ul>
    <p>
      å®¢æˆ¶ï¼ˆä½¿ç”¨è€…ï¼‰ä¸æœƒç›´æ¥æ¥è§¸ Flaskï¼Œè€Œæ˜¯å…ˆé€²åˆ° Nginxï¼Œ  
      ç”± Nginx è½‰çµ¦ Gunicornï¼Œæœ€å¾Œæ‰ç”± Flask è™•ç†ä¸¦å›å‚³çµæœã€‚
    </p>

    <!-- å…«ã€æœ€çµ‚æ¸¬è©¦ -->
    <div class="section-title">âœ… å…«ã€æœ€çµ‚æ¸¬è©¦çµæœ</div>
    <pre><code>http://18.176.60.86/
http://18.176.60.86/status
</code></pre>
    <p>
      æˆåŠŸå›å‚³ JSON å¾Œï¼Œä»£è¡¨æ•´å€‹éƒ¨ç½²æµç¨‹å®Œæˆã€‚  
      ä¸éœ€å†è¼¸å…¥ <code>:5001</code>ï¼Œå³å¯é€é HTTP æ­£å¸¸å‘¼å« APIã€‚
    </p>

    <!-- ä¹ã€ç›®å‰ EC2 é‹è¡Œç‹€æ…‹ -->
    <div class="section-title">ğŸ§­ ä¹ã€ç›®å‰ EC2 é‹è¡Œç‹€æ…‹</div>
    <p>
      ä»¥ä¸‹ç‚ºç›®å‰é€™å° EC2ï¼ˆ<code>t2.micro</code>ï¼‰ä¸»æ©Ÿçš„å¯¦éš›é‹è¡Œæœå‹™ï¼Œ  
      ç¶“ç”± <code>sudo lsof -i -P -n | grep LISTEN</code> èˆ‡ <code>systemctl</code> é©—è­‰ï¼š
    </p>

    <table class="table table-sm">
      <thead><tr><th>æœå‹™</th><th>Port</th><th>ç®¡ç†æ–¹å¼</th><th>å°å¤–é–‹æ”¾</th><th>ç‹€æ…‹</th></tr></thead>
      <tbody>
        <tr><td>SSH (sshd)</td><td>22</td><td>systemd</td><td>âœ…</td><td>æ­£å¸¸ï¼ˆç™»å…¥ä¸»æ©Ÿï¼‰</td></tr>
        <tr><td>Flask é–‹ç™¼ç‰ˆ</td><td>5000</td><td>nohup</td><td>âœ…</td><td>é‹è¡Œä¸­ï¼ˆèˆŠç‰ˆæœ¬ï¼‰</td></tr>
        <tr><td>Gunicorn</td><td>5001</td><td>nohup</td><td>âŒï¼ˆæœ¬æ©Ÿå…§éƒ¨ï¼‰</td><td>é‹è¡Œä¸­ï¼ˆç”± Nginx ä»£ç†ï¼‰</td></tr>
        <tr><td>Nginx</td><td>80</td><td>systemd</td><td>âœ…</td><td>é‹è¡Œä¸­ï¼ˆå°å¤–æœå‹™ï¼‰</td></tr>
      </tbody>
    </table>

    <p>
      ç›®å‰æ•´é«”é‹ä½œåˆç†ä¸”æ¶æ§‹å®Œæ•´ã€‚<br>
      å¤–éƒ¨è«‹æ±‚ç¶“ç”± <b>Nginx (80)</b> â†’ å…§éƒ¨ <b>Gunicorn (5001)</b> â†’ <b>Flask æ‡‰ç”¨</b>ã€‚  
      è‹¥ä¸å†ä½¿ç”¨èˆŠç‰ˆ Flaskï¼Œå¯åœæ­¢ <code>python app.py</code> ä»¥ç¯€çœè³‡æºï¼š
    </p>
    <pre><code>pkill -f app.py</code></pre>

    <p class="text-muted">Gunicorn å°šæœªè¨»å†Šç‚º systemd æœå‹™ï¼Œå› æ­¤é‡å•Ÿ EC2 å¾Œéœ€æ‰‹å‹•å•Ÿå‹•ï¼ˆæœªä¾†å¯æ”¹ç‚ºè‡ªå‹•ï¼‰ã€‚</p>

    <!-- åã€æ•ˆèƒ½æ¯”è¼ƒï¼šEC2 vs Raspberry Pi 5 -->
    <div class="section-title">âš–ï¸ åã€æ•ˆèƒ½æ¯”è¼ƒï¼šEC2 t2.micro vs Raspberry Pi 5</div>
    <p>
      ç‚ºäº†è§£ç›®å‰ EC2 çš„æ€§èƒ½å®šä½ï¼Œä»¥ä¸‹ç‚º t2.microï¼ˆIntel Xeon E5-2686 v4ï¼‰  
      èˆ‡ Raspberry Pi 5ï¼ˆARM Cortex-A76 Ã—4ï¼‰ä¹‹é–“çš„ç°¡è¦æ¯”è¼ƒï¼š
    </p>

    <table class="table table-sm">
      <thead><tr><th>é …ç›®</th><th>EC2 t2.micro</th><th>Raspberry Pi 5</th><th>èªªæ˜</th></tr></thead>
      <tbody>
        <tr><td>CPU</td><td>1 vCPUï¼ˆXeon E5-2686 v4ï¼‰</td><td>4 æ ¸ Cortex-A76 @ 2.4GHz</td><td>Pi 5 ç´„å¿« 3ï½5 å€</td></tr>
        <tr><td>è¨˜æ†¶é«”</td><td>1 GB DDR3</td><td>4ï½8 GB LPDDR4X</td><td>Pi 5 æ˜é¡¯å„ªå‹¢</td></tr>
        <tr><td>å„²å­˜</td><td>8 GB EBSï¼ˆç¶²è·¯ç£ç¢Ÿï¼‰</td><td>microSD / NVMe</td><td>EBS å»¶é²è¼ƒé«˜ï¼Œä½†å¯å¿«ç…§å‚™ä»½</td></tr>
        <tr><td>ç¶²è·¯é »å¯¬</td><td>é«˜é€Ÿé›²ç«¯ç¶²è·¯ï¼ˆ100 Mbpsâ†‘ï¼‰</td><td>Gigabit LAN / Wi-Fi</td><td>EC2 ç©©å®šèˆ‡å»¶é²è¼ƒä½</td></tr>
        <tr><td>æˆæœ¬</td><td>ç´„ $8ï½$10/æœˆ</td><td>ä¸€æ¬¡æ€§ç´„ NT$5,000ï½6,000</td><td>EC2 é©åˆçŸ­æœŸæ¸¬è©¦ï¼ŒPi 5 é©åˆé•·æœŸéƒ¨ç½²</td></tr>
      </tbody>
    </table>

    <p>
      æ•´é«”è€Œè¨€ï¼Œ<b>Raspberry Pi 5</b> çš„åŸå§‹æ•ˆèƒ½æ›´é«˜ï¼ˆCPU èˆ‡è¨˜æ†¶é«”çš†å„ªæ–¼ t2.microï¼‰ï¼Œ  
      è€Œ <b>EC2</b> çš„å„ªå‹¢åœ¨æ–¼é›²ç«¯ç©©å®šæ€§ã€å¤–ç¶²é€£ç·šèˆ‡å¯éš¨æ™‚æ“´å±•ã€‚  
      è‹¥ç”¨æ–¼é›²ç«¯ APIã€æ•´åˆ S3 æˆ– Lambdaï¼ŒEC2 æ›´å…·å½ˆæ€§ï¼›  
      è‹¥ç”¨æ–¼æœ¬åœ°é–‹ç™¼èˆ‡å¯¦é«”æ„Ÿæ¸¬æ•´åˆï¼ŒPi 5 å‰‡æ›´ç¶“æ¿Ÿå¯¦ç”¨ã€‚
    </p>

    <p class="text-muted mt-4">ğŸ“… æ›´æ–°æ—¥æœŸï¼š2025-11-07</p>
  </main>

  <div id="footer"></div>
  <script src="/static/js/layout.js"></script>
</body>
</html>
