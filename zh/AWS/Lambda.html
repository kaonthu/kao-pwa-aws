<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lambda ç­†è¨˜ï½œKAO-YU-HSIANG</title>

  <!-- å…±ç”¨æ¨£å¼ -->
  <link href="/static/css/style.css" rel="stylesheet">

  <!-- å¤–éƒ¨å¥—ä»¶ -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>
  <div id="header"></div>

  <main id="main" class="container">
    <div class="text-center mb-5">
      <h1>ç³»çµ±æ¶æ§‹èˆ‡ Lambda ç­†è¨˜</h1>
      <p class="text-muted">
        æœ¬é è¨˜éŒ„ä»¥ SAM å»ºç«‹/æœ¬åœ°æ¨¡æ“¬/éƒ¨ç½² Lambdaï¼Œä¸¦èˆ‡ API Gateway ä¸²æ¥çš„æµç¨‹èˆ‡é‡é»ã€‚<br>
        ç›®å‰å‡½æ•¸ï¼ˆä¸»æ§å°ï¼‰ï¼š<code>hello-lambda-new-world-HelloWorldFunction</code>ï¼ˆPython 3.12ï¼‰
      </p>
    </div>

    <!-- ğŸ§© ä¸€ã€ç’°å¢ƒç‹€æ…‹ -->
    <div class="section-title">ğŸ§© ä¸€ã€ä½ ç›®å‰çš„ç’°å¢ƒç‹€æ…‹</div>
    <p>
      æœ¬å°ˆæ¡ˆä½æ–¼ï¼š<code>C:\Users\User\Documents\aws-lambda-test\hello-lambda-new</code><br>
      ç”± <b>SAMï¼ˆServerless Application Modelï¼‰</b> å»ºç«‹ï¼Œç”¨æ–¼æœ¬åœ°é–‹ç™¼èˆ‡æ¸¬è©¦ Lambda + API Gatewayï¼Œ
      ä¹‹å¾Œå†ä»¥ <code>sam deploy</code> éƒ¨ç½²åˆ° AWS é›²ç«¯ã€‚
    </p>

    <pre><code>1. aws sts get-caller-identity
{
  "UserId": "AIDAYNSOPZXQP2JJKOWYB",
  "Account": "578911456736",
  "Arn": "arn:aws:iam::578911456736:user/vscode-user"
}
2. å€åŸŸï¼šap-northeast-1</code></pre>

    <!-- â˜ï¸ äºŒã€é›²ç«¯é€£çµ -->
    <div class="section-title">â˜ï¸ äºŒã€ç‚ºä»€éº¼å®ƒèƒ½ã€Œé€£çµåˆ° AWS é›²ç«¯ã€</div>
    <p>
      SAM éƒ¨ç½²æ™‚æœƒé€é <b>CloudFormation Stack</b> å»ºç«‹æ•´å¥—é›²ç«¯è³‡æºï¼š
      <ul>
        <li>Lambda Function</li>
        <li>API Gatewayï¼ˆå« /hello è³‡æºèˆ‡ Stageï¼‰</li>
        <li>IAM Role</li>
        <li>CloudWatch Logs</li>
      </ul>
      æµç¨‹å¦‚ä¸‹ï¼š
    </p>
    <ol>
      <li>åŸ·è¡Œ <code>sam deploy --guided</code>ï¼ŒæŒ‡å®š Stack åç¨±ï¼ˆhello-lambda-new-worldï¼‰ã€‚</li>
      <li>SAM å°‡ç¨‹å¼æ‰“åŒ…å¾Œä¸Šå‚³è‡³è‡¨æ™‚ S3 Bucketã€‚</li>
      <li>CloudFormation æ ¹æ“š <code>template.yaml</code> å»ºç«‹ä¸Šè¿°è³‡æºã€‚</li>
      <li>éƒ¨ç½²æˆåŠŸå¾Œå›å‚³é›²ç«¯ API URLï¼ˆä¾‹ï¼š<code>https://xxxx.execute-api.ap-northeast-1.amazonaws.com/Prod/hello</code>ï¼‰ã€‚</li>
    </ol>
    <p>
      å› æ­¤æ­¤å°ˆæ¡ˆå·²èˆ‡é›²ç«¯ Stack ç¶å®šï¼›åªè¦æœ¬åœ°ä¿®æ”¹ç¨‹å¼å¾ŒåŸ·è¡Œ
      <code>sam build</code> â†’ <code>sam deploy</code>ï¼Œ
      å³å¯è‡ªå‹•æ›´æ–°é›²ç«¯ç‰ˆæœ¬ã€‚
    </p>

    <!-- ğŸ’» ä¸‰ã€æœ¬åœ°é–‹ç™¼ -->
    <div class="section-title">ğŸ’» ä¸‰ã€å›åˆ°æœ¬åœ°é–‹ç™¼ï¼šå¦‚ä½•ç¢ºèªç›®å‰ API</div>
    <ul>
      <li>â‘  é–‹å•Ÿ <code>template.yaml</code> æŸ¥çœ‹å·²å®šç¾©çš„ APIã€‚</li>
      <li>â‘¡ æª¢è¦– Lambda åŸå§‹ç¢¼ï¼ˆ<code>hello_world/app.py</code>ï¼‰ã€‚</li>
      <li>â‘¢ æœ¬åœ°æ¸¬è©¦æŒ‡ä»¤ï¼š</li>
    </ul>
    <pre><code>cd C:\Users\User\Documents\aws-lambda-test\hello-lambda-new\hello-lambda-new-world
sam build
sam local start-api --skip-pull-image
# æ¸¬è©¦ï¼šhttp://127.0.0.1:3000/hello</code></pre>

    <!-- å››ã€æœ¬åœ°æ¸¬è©¦ç’°å¢ƒ -->
    <div class="section-title">å››ã€æœ¬åœ°æ¸¬è©¦ç’°å¢ƒï¼š5000 vs 3000</div>
    <p>
      5000 åŸ ç‚º Flask æœ¬åœ°ä¼ºæœå™¨ï¼Œç”¨æ–¼ä¸€èˆ¬ç¶²é æˆ– API é–‹ç™¼ï¼›  
      3000 åŸ ç”± SAM æ¨¡æ“¬ Lambda + API Gatewayï¼Œè¡Œç‚ºèˆ‡é›²ç«¯éƒ¨ç½²ä¸€è‡´ã€‚  
      è‹¥ç›®æ¨™æ˜¯éƒ¨ç½²è‡³ AWS Lambdaï¼Œå»ºè­°ä»¥ 3000 ç‚ºä¸»è¦æ¸¬è©¦ç’°å¢ƒã€‚
    </p>

    <!-- äº”ã€å¾Œç«¯æ¡†æ¶ -->
    <div class="section-title">äº”ã€å¾Œç«¯æ¡†æ¶èªªæ˜</div>
    <p>
      ç›®å‰æ­¤å°ˆæ¡ˆç‚ºã€Œç´” Python Lambdaï¼ˆç„¡æ¡†æ¶ï¼‰ã€ï¼›ä¸æ˜¯ Flask æˆ– FastAPIã€‚
    </p>
    <table class="table table-bordered" style="font-size:0.95rem;">
      <thead class="table-light"><tr><th>é …ç›®</th><th>èªªæ˜</th></tr></thead>
      <tbody>
        <tr><td>åŸ·è¡Œå…¥å£</td><td><code>Handler: app.lambda_handler</code> â†’ Lambda åŸç”ŸåŸ·è¡Œé»</td></tr>
        <tr><td>å›å‚³æ ¼å¼</td><td><code>statusCode</code>ã€<code>headers</code>ã€<code>body</code> â†’ æ¨™æº– API Gateway Proxy</td></tr>
        <tr><td>ç„¡æ¡†æ¶å¼•ç”¨</td><td>ç¨‹å¼ä¸­ç„¡ <code>from flask import Flask</code> æˆ– <code>from fastapi import FastAPI</code></td></tr>
        <tr><td>æ¨¡æ¿ä¾†æº</td><td><code>sam init</code> ç”¢ç”Ÿçš„ã€ŒHello World Example (Python)ã€</td></tr>
      </tbody>
    </table>

    <!-- åŸæœ¬ç« ç¯€ï¼šç›®çš„ -->
    <div class="section-title">ğŸ¯ å…­ã€ç›®çš„</div>
    <p>åœ¨æœ¬åœ°ç«¯æ¨¡æ“¬ Lambda + API Gateway çš„é‹ä½œï¼Œå®Œæˆé–‹ç™¼èˆ‡æ¸¬è©¦å¾Œå†éƒ¨ç½²åˆ°é›²ç«¯ã€‚</p>

    <!-- é–‹ç™¼ç›®æ¨™ -->
    <div class="section-title">ğŸ§© ä¸ƒã€é–‹ç™¼ç›®æ¨™</div>
    <p>å»ºç«‹ä¸€å€‹ç°¡å–® APIï¼ˆ/helloï¼‰ï¼Œå›å‚³ï¼š</p>
    <pre><code>{"message": "hello world"}</code></pre>

    <!-- åŸºæœ¬æ¦‚å¿µ -->
    <div class="section-title">ğŸ“˜ å…«ã€åŸºæœ¬æ¦‚å¿µ</div>
    <ul>
      <li><b>Lambdaï¼š</b> äº‹ä»¶è§¸ç™¼çš„é‹è¡Œç’°å¢ƒï¼Œå…ç¶­é‹ä¸»æ©Ÿã€‚</li>
      <li><b>API Gatewayï¼š</b> å°å¤–æä¾› HTTP å…¥å£ï¼Œæ•´åˆ Lambdaã€‚</li>
      <li><b>SAMï¼š</b> åŸºæ–¼ CloudFormation çš„ Serverless å°ˆæ¡ˆè…³æ‰‹æ¶ï¼Œå¯æœ¬åœ°æ¨¡æ“¬/éƒ¨ç½²ã€‚</li>
    </ul>

    <!-- æœ¬åœ°é–‹ç™¼ -->
    <div class="section-title">ğŸ§± ä¹ã€æœ¬åœ°é–‹ç™¼æµç¨‹ï¼ˆSAMï¼‰</div>
    <pre><code>sam init
cd hello-lambda-new-world
sam build
sam local start-api --skip-pull-image
# æ¸¬è©¦ï¼šhttp://127.0.0.1:3000/hello</code></pre>
    <p>é æœŸå›å‚³ï¼š<code>{"message": "hello world"}</code></p>

    <!-- é›²ç«¯éƒ¨ç½² -->
    <div class="section-title">â˜ï¸ åã€é›²ç«¯éƒ¨ç½²æµç¨‹</div>
    <pre><code>sam deploy --guided</code></pre>
    <ul>
      <li>å»ºç«‹/æ›´æ–°ï¼šLambda Functionã€API Gatewayã€IAM Roleã€CloudFormation Stackã€‚</li>
      <li>å®Œæˆè¨Šæ¯ï¼š<code>Successfully created/updated stack - hello-lambda-new-world in ap-northeast-1</code></li>
      <li>ç«¯é»ç¯„ä¾‹ï¼š<code>https://xq1nikjgl5.execute-api.ap-northeast-1.amazonaws.com/Prod/hello</code></li>
    </ul>

    <!-- å¸¸è¦‹å•é¡Œ -->
    <div class="section-title">ğŸš¨ åä¸€ã€å¸¸è¦‹å•é¡Œ</div>
    <ul>
      <li><b>Missing Authentication Tokenï¼š</b> è·¯å¾‘éŒ¯èª¤ â†’ ç¢ºèª <code>/hello</code>ã€Stage èˆ‡æ–¹æ³•ã€‚</li>
      <li><b>Binary validation failedï¼š</b> Runtime ä¸ç¬¦ â†’ èª¿æ•´ <code>template.yaml</code> ç‚º <code>python3.12</code>ã€‚</li>
      <li><b>AccessDeniedï¼š</b> æ¬Šé™ä¸è¶³ â†’ æª¢æŸ¥ AWS CLI è¨­å®šæª”èˆ‡ IAM Policyã€‚</li>
    </ul>

    <!-- é‡é»æ‘˜è¦ -->
    <div class="section-title">ğŸ”§ åäºŒã€é‡é»æ‘˜è¦</div>
    <ul>
      <li><code>sam build</code>ï¼šå»ºæ§‹ä¾è³´</li>
      <li><code>sam local start-api</code>ï¼šæœ¬åœ°å•Ÿå‹• API æ¨¡æ“¬</li>
      <li><code>sam deploy</code>ï¼šéƒ¨ç½²è‡³é›²ç«¯</li>
      <li>Lambda ç‚ºçŸ­æš«åŸ·è¡Œç’°å¢ƒï¼Œç„¡éœ€ç¶­é‹ä¸»æ©Ÿ</li>
    </ul>

    <!-- CORS -->
    <div class="section-title">ğŸŒ åä¸‰ã€CORS å•é¡Œèˆ‡è§£æ±ºï¼ˆ2025/11/05ï¼‰</div>
    <p>å‰ç«¯ï¼ˆS3 ç¶²ç«™ï¼‰ä»¥ <code>fetch()</code> å‘¼å«æ™‚éœ€å›æ‡‰ CORS Headerï¼ˆSAM çš„ <code>Cors</code> åœ¨è‡ªå®šç¾© <code>RestApiId</code> æ™‚å¯èƒ½ç„¡æ•ˆï¼‰ï¼š</p>
    <div class="code-wrap">
      <div class="code-title">Lambda å›å‚³ï¼ˆå« CORSï¼‰</div>
      <pre class="pretty-code"><code>return {
  "statusCode": 200,
  "headers": {
    "Access-Control-Allow-Origin": "*",
    "Access-Control-Allow-Headers": "*",
    "Access-Control-Allow-Methods": "GET,POST,OPTIONS"
  },
  "body": json.dumps({"message": "hello world"})
}</code></pre>
    </div>

    <!-- é™„éŒ„ï¼šä¸»æ§å°å°ç…§ -->
    <div class="section-title">ğŸ“ åå››ã€ä¸»æ§å°å°ç…§ï¼ˆç›®å‰ç‹€æ…‹æ‘˜è¦ï¼‰</div>
    <ul>
      <li>Lambda å‡½æ•¸ï¼š
        <ul>
          <li><code>hello-lambda-new-world-HelloWorldFunction</code>ï¼ˆPython 3.12ï¼‰</li>
          <li><code>hello-lambda-HelloWorldFunction</code>ï¼ˆPython 3.10ï¼‰</li>
          <li><code>flask-app-FlaskFunction</code>ï¼ˆPython 3.10ï¼‰</li>
        </ul>
      </li>
      <li>API Gatewayï¼š<code>hello-lambda-new-world</code>ï¼ˆè³‡æºï¼š<code>/hello</code>ã€<code>/test</code>ï¼›æ–¹æ³•ï¼š<code>GET</code>/<code>OPTIONS</code>ï¼‰</li>
    </ul>

    <p class="text-muted mt-4">ğŸ“… æ›´æ–°æ—¥æœŸï¼š2025-11-07</p>
  </main>

  <div id="footer"></div>
  <script src="/static/js/layout.js"></script>
</body>
</html>
